<!DOCTYPE html>
<html data-n-head="lang" data-n-head-ssr lang="en">
  <head>
    <meta data-hid="charset" data-n-head="true" charset="utf-8"><meta data-hid="viewport" data-n-head="true" content="width=device-width,initial-scale=1" name="viewport"><meta data-hid="mobile-web-app-capable" data-n-head="true" content="yes" name="mobile-web-app-capable"><meta data-hid="apple-mobile-web-app-title" data-n-head="true" content="macoshita" name="apple-mobile-web-app-title"><meta data-hid="author" data-n-head="true" content="macoshita" name="author"><meta data-hid="description" data-n-head="true" content="macoshita website" name="description"><meta data-hid="theme-color" data-n-head="true" content="black" name="theme-color"><meta data-hid="og:type" data-n-head="true" content="website" name="og:type" property="og:type"><meta data-hid="og:title" data-n-head="true" content="macoshita" name="og:title" property="og:title"><meta data-hid="og:description" data-n-head="true" content="macoshita website" name="og:description" property="og:description"><title data-n-head="true">The prefetch tag is not work without crossorigin attribute on Amazon S3 - macoshita</title><link href="/_nuxt/manifest.25346d8c.json" rel="manifest" data-n-head="true"><link href="/_nuxt/icons/icon_64.bI0U370z8U0.png" rel="shortcut icon" data-n-head="true"><link href="/_nuxt/icons/icon_512.bI0U370z8U0.png" rel="apple-touch-icon" data-n-head="true" sizes="512x512"><script src="//www.googletagmanager.com/gtm.js?id=GTM-WX4VWRQ&l=dataLayer" async data-n-head="true"></script><link href="/_nuxt/manifest.71412949d7899dded1b3.js" rel="preload" as="script"><link href="/_nuxt/vendor.0d4f966fe985ae7a164f.js" rel="preload" as="script"><link href="/_nuxt/app.6b37b7f4988e1a4a1932.js" rel="preload" as="script"><link href="/_nuxt/layouts/default.4e64ec53dc4da6966f1f.js" rel="preload" as="script"><link href="/_nuxt/pages/blog/_slug.48281ca73f7dbd1eb22b.js" rel="preload" as="script"><link href="/_nuxt/pages/index.3cc03a96935e1bc13b46.js" rel="prefetch"><link href="/_nuxt/5.e028b903f24b3e563373.js" rel="prefetch"><link href="/_nuxt/6.86d4155bac657cb76009.js" rel="prefetch"><link href="/_nuxt/7.83e92dcb1c55c15e6678.js" rel="prefetch"><link href="/_nuxt/8.7d63c71dcb0129837c93.js" rel="prefetch"><link href="/_nuxt/9.791767a21813452251af.js" rel="prefetch"><link href="/_nuxt/10.0c39347437c338b7df6a.js" rel="prefetch"><link href="/_nuxt/11.c20c5ba922ac2bcf4651.js" rel="prefetch"><style data-vue-ssr-id="42d9995c:0">.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;-webkit-transition:width .2s,opacity .4s;transition:width .2s,opacity .4s;opacity:1;background-color:#efc14e;z-index:999999}</style><style data-vue-ssr-id="3f8dfcec:0">body,html{font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Droid Sans,Helvetica Neue,sans-serif}</style><style data-vue-ssr-id="9c1404d0:0">code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#a67f59;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><style data-vue-ssr-id="31f65077:0">._9g5wqN7qORABTQlpycLRy_1 img{max-width:100%}</style>
  </head>
  <body data-n-head="">
    <div id="__nuxt" data-server-rendered="true"><div class="nuxt-progress" style="width:0%;height:2px;background-color:#000;opacity:0"></div><div id="__layout"><div class="container"><header><h1><a href="/" class="nuxt-link-active">macoshita</a></h1></header><main><article><header><h2>The prefetch tag is not work without crossorigin attribute on Amazon S3</h2><time>2018-04-17</time></header><div class="_9g5wqN7qORABTQlpycLRy_1"><p>On Amazon S3, <code>&lt;link rel="prefetch"></code> is not work without crossorigin attribute.</p>
<p><a href="http://macoshita-test-crossorigin.s3-website-ap-northeast-1.amazonaws.com/">Test Site</a></p>
<p>Perhaps Amazon S3 only add CORS headers (Access-Control-Allow-Origin, Access-Control-Allow-Methods ...) when request headers has <code>Origin</code>.<br>
When the document has no crossorigin prefetch tag, access to prefetch URL without origin header on Chrome.<br>
This response is cached Chrome, and reuse next access by <code>script</code> tag.<br>
This cache has no CORS headers. ðŸ˜¢</p>
<h2>Source:</h2>
<pre class="language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>initial-scale=1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>crossorigin test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://s3-ap-northeast-1.amazonaws.com/macoshita-test-crossorigin/main.js<span class="token punctuation">"</span></span>
        <span class="token attr-name">crossorigin</span><span class="token punctuation">></span></span> <span class="token comment">&lt;!-- important --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>crossorigin prefetch test (maybe success)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>test<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>javascript:void(0)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Click to load script<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span>
      script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'https://s3-ap-northeast-1.amazonaws.com/macoshita-test-crossorigin/main.js'</span>
      script<span class="token punctuation">.</span>crossOrigin <span class="token operator">=</span> <span class="token string">'crossorigin'</span>

      document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'head'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>
</code></pre>
<h2>Result:</h2>
<h3>Success</h3>
<p><img src="/blog-img/2018-04-17-1.png" alt="success"></p>
<h3>Fail</h3>
<p><img src="/blog-img/2018-04-17-2.png" alt="fail"></p>
</div></article></main></div></div></div><script type="text/javascript">window.__NUXT__={layout:"default",data:[{slug:"2018-04-17-prefetch-crossorigin-amazon-s3",date:"2018-04-17",title:"The prefetch tag is not work without crossorigin attribute on Amazon S3",lang:"en",content:'<p>On Amazon S3, <code>&lt;link rel=&quot;prefetch&quot;&gt;</code> is not work without crossorigin attribute.</p>\n<p><a href="http://macoshita-test-crossorigin.s3-website-ap-northeast-1.amazonaws.com/">Test Site</a></p>\n<p>Perhaps Amazon S3 only add CORS headers (Access-Control-Allow-Origin, Access-Control-Allow-Methods ...) when request headers has <code>Origin</code>.<br>\nWhen the document has no crossorigin prefetch tag, access to prefetch URL without origin header on Chrome.<br>\nThis response is cached Chrome, and reuse next access by <code>script</code> tag.<br>\nThis cache has no CORS headers. ðŸ˜¢</p>\n<h2>Source:</h2>\n<pre class="language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>initial-scale=1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>crossorigin test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://s3-ap-northeast-1.amazonaws.com/macoshita-test-crossorigin/main.js<span class="token punctuation">"</span></span>\n        <span class="token attr-name">crossorigin</span><span class="token punctuation">></span></span> <span class="token comment">&lt;!-- important --\x3e</span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>crossorigin prefetch test (maybe success)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>test<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>javascript:void(0)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Click to load script<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">\n    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'test\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'click\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'script\'</span><span class="token punctuation">)</span>\n      script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">\'https://s3-ap-northeast-1.amazonaws.com/macoshita-test-crossorigin/main.js\'</span>\n      script<span class="token punctuation">.</span>crossOrigin <span class="token operator">=</span> <span class="token string">\'crossorigin\'</span>\n\n      document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">\'head\'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>\n  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>\n</code></pre>\n<h2>Result:</h2>\n<h3>Success</h3>\n<p><img src="/blog-img/2018-04-17-1.png" alt="success"></p>\n<h3>Fail</h3>\n<p><img src="/blog-img/2018-04-17-2.png" alt="fail"></p>\n'}],error:null,serverRendered:!0}</script><script src="/_nuxt/manifest.71412949d7899dded1b3.js" defer></script><script src="/_nuxt/layouts/default.4e64ec53dc4da6966f1f.js" defer></script><script src="/_nuxt/pages/blog/_slug.48281ca73f7dbd1eb22b.js" defer></script><script src="/_nuxt/vendor.0d4f966fe985ae7a164f.js" defer></script><script src="/_nuxt/app.6b37b7f4988e1a4a1932.js" defer></script>
  

